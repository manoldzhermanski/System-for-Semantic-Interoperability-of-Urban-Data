/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","react"],((e,t,r,n,o)=>(()=>{var i=[e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},(e,t,r)=>{var n=r(6),o=r(24),i=r(25),a=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?o(e):i(e)}},(e,t,r)=>{var n=r(7),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();e.exports=i},e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},e=>{e.exports=function(e){return e}},(e,t,r)=>{var n=r(1),o=r(0);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},(e,t,r)=>{var n=r(2).Symbol;e.exports=n},(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},(e,t,r)=>{var n=r(5),o=r(10);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},(e,t,r)=>{e=r.nmd(e);var n=r(2),o=r(38),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,u=a&&a.exports===i?n.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},(e,t,r)=>{e=r.nmd(e);var n=r(7),o=t&&!t.nodeType&&t,i=o&&e&&!e.nodeType&&e,a=i&&i.exports===o&&n.process,u=function(){try{var e=i&&i.require&&i.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=u},(e,t,r)=>{var n=r(15),o=r(8),i=r(31),a=r(32),u=Object.prototype,l=u.hasOwnProperty,s=n((function(e,t){e=Object(e);var r=-1,n=t.length,s=n>2?t[2]:void 0;for(s&&i(t[0],t[1],s)&&(n=1);++r<n;)for(var c=t[r],f=a(c),p=-1,d=f.length;++p<d;){var y=f[p],h=e[y];(void 0===h||o(h,u[y])&&!l.call(e,y))&&(e[y]=c[y])}return e}));e.exports=s},(e,t,r)=>{var n=r(4),o=r(16),i=r(18);e.exports=function(e,t){return i(o(e,t,n),e+"")}},(e,t,r)=>{var n=r(17),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,a=-1,u=o(i.length-t,0),l=Array(u);++a<u;)l[a]=i[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=i[a];return s[t]=r(l),n(e,this,s)}}},e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},(e,t,r)=>{var n=r(19),o=r(30)(n);e.exports=o},(e,t,r)=>{var n=r(20),o=r(21),i=r(4),a=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i;e.exports=a},e=>{e.exports=function(e){return function(){return e}}},(e,t,r)=>{var n=r(22),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},(e,t,r)=>{var n=r(23),o=r(29);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},(e,t,r)=>{var n=r(5),o=r(26),i=r(0),a=r(28),u=/^\[object .+?Constructor\]$/,l=Function.prototype,s=Object.prototype,c=l.toString,f=s.hasOwnProperty,p=RegExp("^"+c.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(n(e)?p:u).test(a(e))}},(e,t,r)=>{var n=r(6),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=n?n.toStringTag:void 0;e.exports=function(e){var t=i.call(e,u),r=e[u];try{e[u]=void 0;var n=!0}catch(e){}var o=a.call(e);return n&&(t?e[u]=r:delete e[u]),o}},e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},(e,t,r)=>{var n,o=r(27),i=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!i&&i in e}},(e,t,r)=>{var n=r(2)["__core-js_shared__"];e.exports=n},e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),i=16-(o-n);if(n=o,i>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},(e,t,r)=>{var n=r(8),o=r(9),i=r(11),a=r(0);e.exports=function(e,t,r){if(!a(r))return!1;var u=typeof t;return!!("number"==u?o(r)&&i(t,r.length):"string"==u&&t in r)&&n(r[t],e)}},(e,t,r)=>{var n=r(33),o=r(42),i=r(9);e.exports=function(e){return i(e)?n(e,!0):o(e)}},(e,t,r)=>{var n=r(34),o=r(35),i=r(37),a=r(12),u=r(11),l=r(39),s=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=i(e),c=!r&&o(e),f=!r&&!c&&a(e),p=!r&&!c&&!f&&l(e),d=r||c||f||p,y=d?n(e.length,String):[],h=y.length;for(var m in e)!t&&!s.call(e,m)||d&&("length"==m||f&&("offset"==m||"parent"==m)||p&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||u(m,h))||y.push(m);return y}},e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},(e,t,r)=>{var n=r(36),o=r(3),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(e){return o(e)&&a.call(e,"callee")&&!u.call(e,"callee")};e.exports=l},(e,t,r)=>{var n=r(1),o=r(3);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},e=>{var t=Array.isArray;e.exports=t},e=>{e.exports=function(){return!1}},(e,t,r)=>{var n=r(40),o=r(41),i=r(13),a=i&&i.isTypedArray,u=a?o(a):n;e.exports=u},(e,t,r)=>{var n=r(1),o=r(10),i=r(3),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!a[n(e)]}},e=>{e.exports=function(e){return function(t){return e(t)}}},(e,t,r)=>{var n=r(0),o=r(43),i=r(44),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=o(e),r=[];for(var u in e)("constructor"!=u||!t&&a.call(e,u))&&r.push(u);return r}},e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},e=>{"use strict";e.exports=o},e=>{"use strict";e.exports=r},t=>{"use strict";t.exports=e},,e=>{"use strict";e.exports=t},e=>{"use strict";e.exports=n}],a={};function u(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={id:e,loaded:!1,exports:{}};return i[e](r,r.exports,u),r.loaded=!0,r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var l={};return(()=>{"use strict";u.r(l),u.d(l,{plugin:()=>dr});var e,t=u(47),r=u(14),n=u.n(r),o=u(49);!function(e){e.ENTITY="entity",e.TEMPORAL="temporal",e.GEO="geo",e.TYPES="type",e.VERSION="version",e.ATTRIBUTES="attributes",e.NODE_GRAPH="nodegraph"}(e||(e={}));var i;!function(e){e.TOTAL_COUNT="totalCount",e.DISTINCT_COUNT="distinctCount",e.SUM="sum",e.AVERAGE="avg",e.MIN="min",e.MAX="max",e.STANDARD_DEVIATION="stddev",e.SUM_SQUARE="sumsq"}(i||(i={}));var a,s=function(e){if(e)switch(e.toLowerCase()){case"totalcount":case"total_count":return i.TOTAL_COUNT;case"distinctcount":case"distinct_count":return i.DISTINCT_COUNT;case"sum":return i.SUM;case"avg":case"average":return i.AVERAGE;case"min":return i.MIN;case"max":return i.MAX;case"stddev":case"standard_deviation":return i.STANDARD_DEVIATION;case"sumsq":case"sumsquare":case"sum_square":return i.SUM_SQUARE;default:return}};!function(e){e.NONE="none",e.NEAR="near",e.EQUALS="equals",e.DISJOINT="disjoint",e.INTERSECTS="intersects",e.WITHIN="within",e.CONTAINS="contains",e.OVERLAPS="overlaps"}(a||(a={}));var c,f=function(e){if(!e)return a.NONE;if("near"===(e=e.toLowerCase())||e.startsWith("near;"))return a.NEAR;switch(e.toLowerCase()){case"equals":return a.EQUALS;case"disjoint":return a.DISJOINT;case"intersects":return a.INTERSECTS;case"within":return a.WITHIN;case"contains":return a.CONTAINS;case"overlaps":return a.OVERLAPS;default:return a.NONE}};!function(e){e.ENTITY_PLUS_ATTRIBUTE="entity_plus_attribute",e.ENTITY_NAME="entity_name",e.ATTRIBUTE="attribute"}(c||(c={}));var p=function(e){switch(null==e?void 0:e.toLowerCase()){case"entity_name":return c.ENTITY_NAME;case"attribute":return c.ATTRIBUTE;default:return c.ENTITY_PLUS_ATTRIBUTE}},d={queryType:e.TEMPORAL.valueOf()};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e,t){if("object"!=y(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==y(t)?t:t+""}var v=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"concatPaths",value:function(e,t){if(!e)return t;if(!t)return e;var r=e.endsWith("/"),n=t.startsWith("/");return r&&n?t=t.substring(1):r||n||(t="/"+t),e+t}},{key:"appendQueryParam",value:function(e,t){var r=e.indexOf("?")>=0?"&":"?";return e+r+t}}],(t=null)&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),b={CEL:"°C",KEL:"K",MTR:"m",CMT:"cm",DMT:"dm",MMT:"mm",KTM:"km",KMT:"km",C81:"rad",DD:"°",D61:"'",D62:'"',C47:"ns",B98:"µs",C26:"ms",SEC:"s",MIN:"min",HUR:"h",DAY:"d",ANN:"y",MTS:"m/s",KMH:"km/h","2X":"m/min",M62:"km/s",MSK:"m/s²","2A":"rad/s",M46:"r/min",MGM:"mg",GRM:"g",KGM:"kg",TNE:"t",KTN:"kt",74:"mPa",PAL:"Pa",KPA:"kPa",HBA:"hbar",MBR:"mbar",BAR:"bar",KBA:"kbar",ATM:"atm",JOU:"J",KJO:"kJ","3B":"MJ",GV:"GJ",WHR:"Wh",KWH:"kWh",MWH:"MWh",GWH:"GWh",A53:"eV",B29:"keV",B71:"MeV",A85:"GeV",C31:"mW",WTT:"W",KWT:"kW",MAW:"MW",A90:"GW",D46:"VA",KVA:"kVA",MVA:"MVA",AMP:"A",B22:"kA","4K":"mA",COU:"C",AMH:"Ah",TAH:"kAh",VLT:"V",KVT:"kV","2Z":"mV",D50:"V/m",D33:"T",C29:"mT",OHM:"Ω",E45:"mΩ",B49:"kΩ",B75:"MΩ",MTK:"m²",MTQ:"m³",LTR:"l",MLT:"ml",HTZ:"Hz",NEW:"N",C62:"",KGS:"kg/s",MQS:"m³/s",MQH:"m³/h",B11:"J/(kg K)",B43:"kJ/(kg K)","2N":"dB",BQL:"Bq"};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}var E=function(e){if(null!=e){if("object"!==g(e))return e;if(Array.isArray(e))return e.map(E);if(void 0!==(null==e?void 0:e.value))return"object"===g(e.value)&&"@value"in e.value?e.value["@value"]:e.value}},w=function(e){var t=E(e);if(isFinite(t)&&"object"===g(e)){var r=e.unitCode;r&&(t=t+((r=b[r]||r).startsWith("°")?"":" ")+r)}return t},T=Object.freeze(["id","type","@context"]),O=u(50);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function A(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,I(n.key),n)}}function I(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var P=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"handleGeoResult",value:function(e,r){var n=e.map((function(e){return Object.keys(e)})).flatMap((function(e){return e})).filter((function(e){return"@context"!==e&&"location"!==e&&"operationSpace"!==e&&"observationSpace"!==e})),o=(n=A(new Set(n))).map((function(e){return{name:e,values:[]}})),i={name:"longitude",values:[]},a={name:"latitude",values:[]},u={name:"name",values:[]};return e.forEach((function(e){var t,n=e.location,l=null==n?void 0:n.value;if("Point"===l.type){o.forEach((function(t){var r=E(e[t.name]);t.values.push(r)}));var s=l.coordinates;i.values.push(s[0]),a.values.push(s[1]);var c=r.entityName&&r.entityName in e?r.entityName:"id",f=(null===(t=E(e[c]))||void 0===t?void 0:t.toString())||e.id;if("id_short"===r.entityName||!r.entityName&&!r.useLongEntityName){var p=f.lastIndexOf(":");p>=0&&p<f.length-1&&(f=f.substring(p+1))}u.values.push(f)}})),[a,i,u].forEach((function(e){return o.unshift(e)})),new t.MutableDataFrame({refId:r.refId,fields:o})}}],(r=null)&&N(e.prototype,r),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function j(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||M(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(){_=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),u=new j(n||[]);return o(a,"_invoke",{value:C(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",m={};function v(){}function b(){}function g(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,T=w&&w(w(k([])));T&&T!==r&&n.call(T,a)&&(E=T);var O=g.prototype=v.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var s=l.arg,c=s.value;return c&&"object"==x(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,r,n){var o=p;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=N(u,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(t,r,n);if("normal"===s.type){if(o=n.done?h:d,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=h,n.method="throw",n.arg=s.arg)}}}function N(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,N(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function k(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(x(t)+" is not iterable")}return b.prototype=g,o(O,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=s(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(A.prototype),s(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new A(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),s(O,l,"Generator"),s(O,a,(function(){return this})),s(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=k,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:k(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(e,t)||M(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function M(e,t){if(e){if("string"==typeof e)return F(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function R(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){D(i,n,o,a,u,"next",e)}function u(e){D(i,n,o,a,u,"throw",e)}a(void 0)}))}}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,q(n.key),n)}}function q(e){var t=function(e,t){if("object"!=x(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==x(t)?t:t+""}var U=function(){return r=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.datasource=t,this.query=r},n=[{key:"handleGraphResult",value:(u=R(_().mark((function e(r,n){var o,i,a,u,l,s,c,f,p,d,y,h,m,v,b,g,T,O,S,A,C,N,I,P=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveMissingEntities(r,n);case 2:r=e.sent,o=function(e){var t,r=P.query.entityName&&P.query.entityName in e?P.query.entityName:"id",n=(null===(t=E(e[r]))||void 0===t?void 0:t.toString())||e.id;if("id_short"!==P.query.entityName||!P.query.entityName&&P.query.useLongEntityName)return n;var o=n.lastIndexOf(":");return o>0&&o<n.length-1?n.substring(o+1):n},i={name:"id",values:[],type:t.FieldType.string},a={name:"title",values:[],type:t.FieldType.string},u={name:"suntitle",values:[],type:t.FieldType.string},l={name:"mainStat",values:[],type:t.FieldType.string,config:{}},s={name:"secondaryStat",values:[],type:t.FieldType.string,config:{}},c={name:"arc__zone1",values:[],type:t.FieldType.number,config:{color:{mode:"fixed",fixedColor:"green"}}},f={name:"arc__zone2",values:[],type:t.FieldType.number,config:{color:{mode:"fixed",fixedColor:"red"}}},p={name:"arc__neutral",values:[],type:t.FieldType.number,config:{displayName:"n.a."}},d=function(e,t,r){if(t){var n=t[e.type]||t[""];if(n){var o=n.find((function(t){return t in e}));if(o){if(null!=r&&r.returnAttribute)return o;var i=e[o];return Array.isArray(i)&&i.length>0&&(i=i[0]),null!=r&&r.skipUnit?E(i):w(i)}}}},y=function(e,t){if(t){var n=r.find((function(e){return d(e,t,{returnAttribute:!0})}));if(n){var o=d(n,t,{returnAttribute:!0});e.config.displayName=o}}},y(l,this.query.primaryNodeAttributes),y(s,this.query.secondaryNodeAttributes),this.query.arcColorNodeAttributes&&(h=r.find((function(e){return d(e,P.query.arcColorNodeAttributes,{returnAttribute:!0})})))&&(m=d(h,this.query.arcColorNodeAttributes,{returnAttribute:!0}),c.config.displayName=m,f.config.displayName=this.query.arcColorComplementLabel||"~"+m,this.query.primaryArcColor&&(c.config.color.fixedColor=this.query.primaryArcColor),this.query.secondaryArcColor&&(f.config.color.fixedColor=this.query.secondaryArcColor)),r.forEach((function(e){var t,r,n,y=o(e),h=e.type,m=h.lastIndexOf(".");m>=0&&m<h.length-1&&(h=h.substring(m+1));var v=y.indexOf(h)>=0?"":h;i.values.push(e.id),a.values.push(y),u.values.push(v),l.values.push(d(e,null===(t=P.query)||void 0===t?void 0:t.primaryNodeAttributes)),s.values.push(d(e,null===(r=P.query)||void 0===r?void 0:r.secondaryNodeAttributes));var b=d(e,null===(n=P.query)||void 0===n?void 0:n.arcColorNodeAttributes,{skipUnit:!0}),g=1-b,E=isFinite(b)?0:1;c.values.push(b),f.values.push(g),p.values.push(E)})),v={name:"id",values:[],type:t.FieldType.string},b={name:"source",values:[],type:t.FieldType.string},g={name:"target",values:[],type:t.FieldType.string},T={name:"mainStat",values:[]},O=L(r),e.prev=23,A=_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=S.value,Object.entries(t).filter((function(e){var t=k(e,2),n=(t[0],t[1]);return"Relationship"===(null==n?void 0:n.type)&&void 0!==(null==n?void 0:n.object)&&void 0!==r.find((function(e){return e.id===n.object}))})).forEach((function(e){var r=k(e,2),n=r[0],o=r[1];v.values.push(t.id+"__"+n),b.values.push(t.id),g.values.push(o.object),T.values.push(n)}));case 3:case"end":return e.stop()}}),e)})),O.s();case 26:if((S=O.n()).done){e.next=30;break}return e.delegateYield(A(),"t0",28);case 28:e.next=26;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(23),O.e(e.t1);case 35:return e.prev=35,O.f(),e.finish(35);case 38:return C=[i,a,u],this.query.primaryNodeAttributes&&C.push(l),this.query.secondaryNodeAttributes&&C.push(s),this.query.arcColorNodeAttributes&&(C.push(c,f),p.values.findIndex((function(e){return e>0}))>=0&&C.push(p)),N=new t.MutableDataFrame({refId:this.query.refId,fields:C,meta:{preferredVisualisationType:"nodeGraph"},name:"nodes"}),I=new t.MutableDataFrame({refId:this.query.refId,fields:[v,b,g,T],meta:{preferredVisualisationType:"nodeGraph"},name:"edges"}),e.abrupt("return",[N,I]);case 45:case"end":return e.stop()}}),e,this,[[23,32,35,38]])}))),function(e,t){return u.apply(this,arguments)})},{key:"resolveMissingEntities",value:(a=R(_().mark((function e(t,r){var n,o,i,a,u,l,s,c=arguments;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>2&&void 0!==c[2]?c[2]:0,!(r<=0)){e.next=3;break}return e.abrupt("return",t);case 3:for(o=new Set,i=n;i<t.length;i++)a=t[i],Object.entries(a).filter((function(e){var t=k(e,2),r=(t[0],t[1]);return"Relationship"===(null==r?void 0:r.type)&&void 0!==(null==r?void 0:r.object)})).map((function(e){var t=k(e,2);return t[0],t[1].object})).filter((function(e){return void 0===t.find((function(t){return t.id===e}))})).forEach((function(e){return o.add(e)}));return e.next=7,this.getEntites(o);case 7:if(0!==(u=e.sent).length){e.next=10;break}return e.abrupt("return",t);case 10:return l=t.length,t.push.apply(t,j(u)),e.next=14,this.resolveMissingEntities(t,r--,l);case 14:return s=e.sent,e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"getEntites",value:(i=R(_().mark((function t(r){var n,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==r.size){t.next=2;break}return t.abrupt("return",[]);case 2:return n=j(r).join(","),t.next=5,this.datasource.request({queryType:e.ENTITY,entityId:n});case 5:if(o=t.sent){t.next=8;break}return t.abrupt("return",[]);case 8:return Array.isArray(o)||(o=[o]),t.abrupt("return",o);case 10:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})}],n&&G(r.prototype,n),o&&G(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,u}();function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function Y(e){return function(e){if(Array.isArray(e))return V(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||W(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=W(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function W(e,t){if(e){if("string"==typeof e)return V(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?V(e,t):void 0}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function H(){H=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),u=new x(n||[]);return o(a,"_invoke",{value:C(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",m={};function v(){}function b(){}function g(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,T=w&&w(w(j([])));T&&T!==r&&n.call(T,a)&&(E=T);var O=g.prototype=v.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var s=l.arg,c=s.value;return c&&"object"==B(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,r,n){var o=p;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=N(u,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(t,r,n);if("normal"===s.type){if(o=n.done?h:d,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=h,n.method="throw",n.arg=s.arg)}}}function N(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,N(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(B(t)+" is not iterable")}return b.prototype=g,o(O,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=s(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(A.prototype),s(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new A(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),s(O,l,"Generator"),s(O,a,(function(){return this})),s(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function K(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function J(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){K(i,n,o,a,u,"next",e)}function u(e){K(i,n,o,a,u,"throw",e)}a(void 0)}))}}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,re(n.key),n)}}function $(e,t,r){return t=Z(t),function(e,t){if(t&&("object"==B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,X()?Reflect.construct(t,r||[],Z(e).constructor):t.apply(e,r))}function X(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(X=function(){return!!e})()}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e,t,r){return(t=re(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e){var t=function(e,t){if("object"!=B(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==B(t)?t:t+""}var ne,oe,ie,ae,ue,le,se,ce=function(r){function i(e){var t,r,n,o,a,u,l,s,c,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),te(f=$(this,i,[e]),"baseUrl",void 0),te(f,"timeseriesUrl",void 0),te(f,"contextUrl",void 0),te(f,"contextLinkHeader",void 0),te(f,"flavour",void 0),te(f,"tenant",void 0),te(f,"formatParameter",void 0),te(f,"avoidSimplifiedTemporalFormat",void 0);var p=e.url||"";p.indexOf("/ngsi-ld/v1")<0&&(p=v.concatPaths(p,"/ngsi-ld/v1")),f.baseUrl=p,f.flavour=(null===(t=e.jsonData)||void 0===t||null===(r=t.flavour)||void 0===r?void 0:r.toLowerCase())||"generic",f.tenant=(null===(n=e.jsonData)||void 0===n||null===(o=n.tenant)||void 0===o?void 0:o.trim())||void 0,f.formatParameter="format"===(null===(a=e.jsonData)||void 0===a||null===(u=a.formatParameter)||void 0===u?void 0:u.toLowerCase())?"format":"options",f.avoidSimplifiedTemporalFormat=!!e.jsonData.avoidSimplifiedTemporalFormat;var d=(null===(l=e.jsonData)||void 0===l?void 0:l.timeseriesUrl)||"",y="proxy"===e.access?v.concatPaths((null===(s=e.url)||void 0===s?void 0:s.replace("/ngsi-ld/v1",""))||"","temporal"):d;return f.timeseriesUrl=y,f.contextUrl=(null===(c=e.jsonData)||void 0===c?void 0:c.contextUrl)||"",f.contextLinkHeader=f.contextUrl?"<"+f.contextUrl+'>; rel="http://www.w3.org/ns/json-ld#context"; type="application/ld+json"':"",f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(i,r),a=i,u=[{key:"query",value:(h=J(H().mark((function e(t){var r,i,a,u,l=this;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,o.getBackendSrv)(),i=t.range,a=t.targets.map((function(e){var t,o;return l.querySingle(n()(e,d),{backend:r,from:null==i||null===(t=i.from)||void 0===t?void 0:t.valueOf(),to:null==i||null===(o=i.to)||void 0===o?void 0:o.valueOf()})})),e.next=5,Promise.all(a);case 5:return u=e.sent.filter((function(e){return(null==e?void 0:e.length)>0})).flatMap((function(e){return e})),e.abrupt("return",{data:u});case 7:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})},{key:"querySingle",value:(y=J(H().mark((function r(n,o){var i,a,u,l,s,f,d=this;return H().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.entityType||n.entityId||(null===(i=n.attributes)||void 0===i?void 0:i.length)>0){r.next=2;break}return r.abrupt("return",[]);case 2:return r.next=4,this.request(n,o);case 4:if(a=r.sent,Array.isArray(a)||(a=[a]),n.queryType!==e.GEO){r.next=8;break}return r.abrupt("return",[P.handleGeoResult(a,n)]);case 8:if(n.queryType!==e.NODE_GRAPH){r.next=10;break}return r.abrupt("return",new U(this,n).handleGraphResult(a,4));case 10:u=[],l=Q(a),r.prev=12,f=H().mark((function r(){var i,a,l,f,y,h,m,v,b,g,w;return H().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=s.value,l=p(n.namePattern),f=l!==c.ATTRIBUTE&&"id"!==n.entityName&&"id_short"!==n.entityName&&n.entityName&&n.entityName in a?n.entityName:"id",y=l===c.ATTRIBUTE?"":(null===(i=E(a[f]))||void 0===i?void 0:i.toString())||a.id,("id_short"===n.entityName||void 0===n.entityName&&!n.useLongEntityName)&&(h=y.lastIndexOf(":"))>=0&&h<y.length-1&&(y=y.substring(h+1)),l===c.ENTITY_PLUS_ATTRIBUTE&&(y+=":"),m=Object.keys(a),v=Y(T),"id"!==f&&v.push(f),v.forEach((function(e){var t=m.indexOf(e);t>=0&&m.splice(t,1)})),b=H().mark((function r(){var i,s,f,p,h,m,v,b,T,S,A,C,N;return H().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=w[g],"Relationship"!==a[i].type){r.next=3;break}return r.abrupt("return",1);case 3:if(s=l===c.ENTITY_NAME?y:y+i,d.avoidSimplifiedTemporalFormat||!a[i].values){r.next=11;break}f=a[i].values,p={name:s,values:f.map((function(e){return e[0]})),type:t.FieldType.number},h={name:"Time",values:f.map((function(e){return new Date(e[1]).getTime()})),type:t.FieldType.time},u.push(new t.MutableDataFrame({refId:n.refId,fields:[h,p]})),r.next=25;break;case 11:if(!d.avoidSimplifiedTemporalFormat||n.queryType!==e.TEMPORAL){r.next=24;break}if(m=n.timeProperty||"observedAt",v=a[i],Array.isArray(v)){r.next=16;break}throw new Error("Temporal property array expected for attribute "+i);case 16:if(!(v.length>0)){r.next=22;break}if(m in v[0]){r.next=19;break}throw new Error("Temporal representation is missing the expected time attribute "+m+" for attribute "+i);case 19:b={name:s,values:v.map(E),type:t.FieldType.number},T={name:"Time",values:v.map((function(e){return new Date(e[m]).getTime()})),type:t.FieldType.time},u.push(new t.MutableDataFrame({refId:n.refId,fields:[T,b]}));case 22:r.next=25;break;case 24:void 0!==a[i].value&&("object"===B(S=a[i].value)&&"@value"in S&&(S=S["@value"]),(0,O.isNumber)(S)?t.FieldType.number:"string"==typeof S?t.FieldType.string:!1===S||!0===S?t.FieldType.boolean:t.FieldType.other,A={name:s,values:[S],type:t.FieldType.number},C=isFinite(a[i].observedAt)?a[i].observedAt:isFinite(null==o?void 0:o.from)&&isFinite(null==o?void 0:o.to)?((null==o?void 0:o.from)+(null==o?void 0:o.to))/2:isFinite(null==o?void 0:o.from)?null==o?void 0:o.from:isFinite(null==o?void 0:o.to)?o.to:Date.now(),N={name:"Time",values:[C],type:t.FieldType.time},u.push(new t.MutableDataFrame({refId:n.refId,fields:[N,A]})));case 25:case"end":return r.stop()}}),r)})),g=0,w=m;case 13:if(!(g<w.length)){r.next=20;break}return r.delegateYield(b(),"t0",15);case 15:if(!r.t0){r.next=17;break}return r.abrupt("continue",17);case 17:g++,r.next=13;break;case 20:case"end":return r.stop()}}),r)})),l.s();case 15:if((s=l.n()).done){r.next=19;break}return r.delegateYield(f(),"t0",17);case 17:r.next=15;break;case 19:r.next=24;break;case 21:r.prev=21,r.t1=r.catch(12),l.e(r.t1);case 24:return r.prev=24,l.f(),r.finish(24);case 27:return r.abrupt("return",u);case 28:case"end":return r.stop()}}),r,this,[[12,21,24,27]])}))),function(e,t){return y.apply(this,arguments)})},{key:"request",value:(f=J(H().mark((function t(r,n){var a,u,l,s,f,p,d,y,h,m,b,g,E,w,T,O,S,A,C,N,I;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f=(null==n?void 0:n.backend)||(0,o.getBackendSrv)(),d=[],t.t0=r.queryType,t.next=t.t0===e.TEMPORAL?5:t.t0===e.VERSION?11:t.t0===e.TYPES?13:t.t0===e.ATTRIBUTES?15:t.t0===e.GEO||t.t0===e.NODE_GRAPH||t.t0===e.ENTITY?18:22;break;case 5:return p="/temporal/entities",r.entityId&&(p+="/"+r.entityId),this.avoidSimplifiedTemporalFormat||d.push("temporalValues"),r.aggrMethod&&(d.push("aggregatedValues"),p=v.appendQueryParam(p,"aggrMethods="+r.aggrMethod),r.aggrPeriodDuration&&(p=v.appendQueryParam(p,"aggrPeriodDuration="+r.aggrPeriodDuration))),r.timeProperty&&"observedAt"!==r.timeProperty&&(p=v.appendQueryParam(p,"timeproperty="+r.timeProperty)),t.abrupt("break",23);case 11:return p="orion"===this.flavour?"/version":"/types",t.abrupt("break",23);case 13:return p="/types?details=true",t.abrupt("break",23);case 15:if(r.entityId){t.next=18;break}return p="/attributes",t.abrupt("break",23);case 18:return p="/entities",r.entityId&&(y=r.entityId.indexOf(",")>=0,p+=y?"?id="+r.entityId.split(",").map((function(e){return e.trim()})).filter((function(e){return e})).map(encodeURIComponent).join(","):"/"+r.entityId),r.queryType===e.GEO?(null===(h=r.attributes)||void 0===h?void 0:h.length)>0?r.attributes.indexOf("location")<0&&r.attributes.push("location"):p=v.appendQueryParam(p,"q=location"):r.queryType===e.NODE_GRAPH&&(m=r.attributes||[],(b=function(e){var t;e&&(t=m).push.apply(t,Y(new Set(Object.values(e).flatMap((function(e){return e})))))})(r.primaryNodeAttributes),b(r.secondaryNodeAttributes),b(r.arcColorNodeAttributes),(m=Y(new Set(m))).length>0&&(r.attributes=m)),t.abrupt("break",23);case 22:throw new Error("Invalid query type "+r.queryType);case 23:return r.entityType&&!r.entityId&&(p=v.appendQueryParam(p,"type="+encodeURIComponent(r.entityType))),(null===(a=r.attributes)||void 0===a?void 0:a.length)>0&&(r.namePattern!==c.ATTRIBUTE.valueOf()&&r.entityName&&"id"!==r.entityName&&"id_short"!==r.entityName&&(null===(E=r.attributes)||void 0===E||E.push(r.entityName)),p=v.appendQueryParam(p,"attrs="+(null===(g=r.attributes)||void 0===g?void 0:g.map(encodeURIComponent).join(",")))),r.queryType===e.TEMPORAL&&(p=i.setTimeInterval(p,null==n?void 0:n.from,null==n?void 0:n.to)),r.georel&&(p=v.appendQueryParam(p,"georel="+encodeURIComponent(r.georel)),r.geometry&&(p=v.appendQueryParam(p,"geometry="+encodeURIComponent(r.geometry))),r.coordinates&&(p=v.appendQueryParam(p,"coordinates="+encodeURIComponent(r.coordinates))),r.geoproperty&&(p=v.appendQueryParam(p,"geoproperty="+encodeURIComponent(r.geoproperty)))),r.customQuery&&(p=v.appendQueryParam(p,"q="+encodeURIComponent(r.customQuery))),w=function(e,t,r){return isFinite(r)?v.appendQueryParam(e,encodeURIComponent(t)+"="+encodeURIComponent(r)):e},T=function(e,t,r){var n,o=Q(r);try{for(o.s();!(n=o.n()).done;){var i=n.value;e=w(e,i,t[i])}}catch(e){o.e(e)}finally{o.f()}return e},n&&(p=T(p,n,["limit","offset","lastN"])),d.length>0&&(p=v.appendQueryParam(p,this.formatParameter+"="+d.join(","))),(null===(u=r.scopeQuery)||void 0===u||null===(l=u.trim())||void 0===l?void 0:l.length)>0&&((O=r.scopeQuery.trim()).startsWith('"')||O.startsWith("'")||(O='"'+O+'"'),p=v.appendQueryParam(p,"scopeQ="+O)),S=null===(s=p)||void 0===s?void 0:s.startsWith("/version"),A=S?this.baseUrl.replace("/ngsi-ld/v1",""):r.queryType===e.TEMPORAL?this.timeseriesUrl:this.baseUrl,C=v.concatPaths(A,p),N={method:"GET",url:C,responseType:"json",headers:{Accept:"application/json"}},this.contextUrl&&!S&&(N.headers={Link:this.contextLinkHeader,Accept:"application/ld+json"}),this.tenant&&(N.headers["NGSILD-Tenant"]=this.tenant),t.next=41,i.toPromise(f.fetch(N));case 41:return I=t.sent,t.abrupt("return",I);case 43:case"end":return t.stop()}}),t,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"testDatasource",value:(s=J(H().mark((function t(){return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.request({queryType:e.VERSION}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})}],l=[{key:"setTimeInterval",value:function(e,t,r){var n=isFinite(t),o=isFinite(r);if(n||o){var i=n&&o?"between":n?"after":"before";e=v.appendQueryParam(e,"timerel="+i);var a=n?t:r;e=v.appendQueryParam(e,"timeAt="+new Date(a).toISOString()),n&&o&&(e=v.appendQueryParam(e,"endTimeAt="+new Date(r).toISOString()))}return e}},{key:"toPromise",value:function(e){return new Promise((function(t,r){e.subscribe({next:function(e){if(!e.ok){var n=e.status+": "+e.statusText;e.data&&(n+=" ("+e.data+")"),r("Failed to contact data source "+n)}t(e.data)},error:function(e){return r(e)}})}))}}],u&&z(a.prototype,u),l&&z(a,l),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,u,l,s,f,y,h}(t.DataSourceApi),fe=u(45),pe=u.n(fe),de=u(46);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},he.apply(null,arguments)}function me(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Te(n.key),n)}}function ve(e,t,r){return t=ge(t),function(e,t){if(t&&("object"==ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,be()?Reflect.construct(t,r||[],ge(e).constructor):t.apply(e,r))}function be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(be=function(){return!!e})()}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}function we(e,t,r){return(t=Te(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e){var t=function(e,t){if("object"!=ye(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ye(t)?t:t+""}de.LegacyForms.SecretFormField;var Oe,Se,Ae,Ce,Ne,Ie,Pe,xe=de.LegacyForms.FormField,je=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return we(e=ve(this,t,[].concat(n)),"onUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{url:null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim()}))})),we(e,"onContextUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{jsonData:he({},o.jsonData,{contextUrl:(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||""})}))})),we(e,"onTenantChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{jsonData:he({},o.jsonData,{tenant:(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||""})}))})),we(e,"onFormatParameterChange",(function(t){var r="format"===t.value?"format":"options",n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{jsonData:he({},o.jsonData,{formatParameter:r})}))})),we(e,"onTemporalRepChange",(function(t){var r="expanded"===t.value,n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{jsonData:he({},o.jsonData,{avoidSimplifiedTemporalFormat:r})}))})),we(e,"onTimeseriesUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(he({},o,{jsonData:he({},o.jsonData,{timeseriesUrl:(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||""})}))})),we(e,"onAccessModeChange",(function(t){var r=e.props,n=r.options;(0,r.onOptionsChange)(he({},n,{access:t.value||"proxy"}))})),we(e,"onFlavourChange",(function(t){var r=e.props,n=r.options;(0,r.onOptionsChange)(he({},n,{jsonData:he({},n.jsonData,{flavour:t.value||"generic"})}))})),we(e,"onAuthStatusChange",(function(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=he({},n.jsonData,{authType:t?"oauth":void 0});o(he({},n,{jsonData:i}))})),we(e,"onClientIdChange",(function(t){if(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=he({},n.secureJsonData||{},{clientId:t});o(he({},n,{secureJsonData:i}))}})),we(e,"onClientSecretChange",(function(t){if(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=he({},n.secureJsonData||{},{clientSecret:t});o(he({},n,{secureJsonData:i}))}})),we(e,"onTokenServerChange",(function(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=he({},n.jsonData,{tokenUrl:t});o(he({},n,{jsonData:i}))})),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ee(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e,t=this,r=this.props.options,n=r.jsonData,o=r.secureJsonFields,i=r.secureJsonData,a="direct"===r.access,u="oauth"===n.authType,l=u&&o.clientId&&o.clientSecret;return pe().createElement("div",{className:"gf-form-group"},pe().createElement("div",{className:"gf-form"},pe().createElement(xe,{label:"Context broker URL",labelWidth:12,inputWidth:20,onChange:this.onUrlChange,value:r.url||"",placeholder:"http://localhost:1026"})),pe().createElement("div",{className:"gf-form"},pe().createElement(xe,{label:"Temporal broker URL",labelWidth:12,inputWidth:20,onChange:this.onTimeseriesUrlChange,value:n.timeseriesUrl||"",placeholder:"http://localhost:1026"})),pe().createElement("div",{className:"gf-form"},pe().createElement(xe,{label:"Context URL",labelWidth:12,inputWidth:20,onChange:this.onContextUrlChange,value:n.contextUrl||"",placeholder:"http://localhost:80/ngsi-context.jsonld"})),pe().createElement("div",{className:"gf-form"},pe().createElement(xe,{label:"Tenant",tooltip:"Optional tenant id. Formerly called 'Fiware-Service'.",labelWidth:12,inputWidth:20,onChange:this.onTenantChange,value:n.tenant||"",placeholder:"Tenant id"})),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},ne||(ne=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select a format parameter supported by the broker. Default is 'options', which is supported by most brokers, but deprecated in the spec in favour of 'format'."},"Format parameter")),pe().createElement(de.Select,{options:[{value:"options",title:"The legacy mode, supported by most browsers (default).",label:"options"},{value:"format",title:"The spec-conformant parameter, not yet widely supported.",label:"format"}],value:n.formatParameter||"options",onChange:this.onFormatParameterChange,width:20}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},oe||(oe=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select temporal representation. Default: 'simplified', which compresses timeseries into an array of [value, timestamp] pairs."},"Temporal representation")),pe().createElement(de.Select,{options:[{value:"simplified",title:"The default simplified mode, represents timeseries data efficiently as array of [value, timestamp] pairs.",label:"simplified"},{value:"expanded",title:"Represents timeseries data as array of property objects. Potentially inefficient for large arrays.",label:"expanded"}],value:n.avoidSimplifiedTemporalFormat?"expanded":"simplified",onChange:this.onTemporalRepChange,width:20}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},ie||(ie=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the access mode for the plugin, either sending requests to the broker through Grafana as a proxy (recommended), or directly from the browser to the broker. Note that user authentication is only supported in proxy mode."},"Access")),pe().createElement(de.Select,{options:[{value:"proxy",title:"Send broker requests via the backend (recommended)",label:"proxy"},{value:"direct",title:"Send broker requests from the browser (not recommended)",label:"direct"}],value:r.access||"proxy",onChange:this.onAccessModeChange,width:20}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},ae||(ae=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the NGSI-LD broker type. This is not too important, it only determines how the test request to check if the datasource is alive is formed."},"Flavour")),pe().createElement(de.Select,{options:[{value:"generic",title:"Any NGSI-LD compatible broker",label:"generic"},{value:"orion",title:"Orion-LD context broker",label:"orion"}],value:(null===(e=r.jsonData)||void 0===e?void 0:e.flavour)||"generic",onChange:this.onFlavourChange,width:20}))),!a&&pe().createElement(pe().Fragment,null,pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},pe().createElement(de.Checkbox,{checked:u,onChange:function(e){return t.onAuthStatusChange(e.currentTarget.checked)},label:"Authentication active?",title:"If checked, OAuth 2.0 authentication will be enabled for the datasource. Use with a context broker secured by means of OAuth."}))),u&&pe().createElement(pe().Fragment,null,pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},ue||(ue=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"OAuth token server"},"OAuth token URL")),pe().createElement(de.Input,{value:n.tokenUrl||"",placeholder:"https://my.auth.server.com/v1/oauth/token",onChange:function(e){var r;return t.onTokenServerChange(null===(r=e.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth token server."}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},le||(le=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"OAuth client id. This must be configured in the authentication server, too."},"Client id")),pe().createElement(de.Input,{value:(null==i?void 0:i.clientId)||"",placeholder:l?"Value configured":"No client id configured yet",onChange:function(e){var r;return t.onClientIdChange(null===(r=e.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth client id. This must be configured in the authentication server.",type:"password"}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},se||(se=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"OAuth client secret. This must be configured in the authentication server, too."},"Client secret")),pe().createElement(de.Input,{value:(null==i?void 0:i.clientSecret)||"",placeholder:l?"Value configured":"No client secret configured yet",onChange:function(e){var r;return t.onClientSecretChange(null===(r=e.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth client secret. This must be configured in the authentication server, too.",type:"password"}))))))}}])&&me(r.prototype,n),o&&me(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(fe.PureComponent);function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function ke(e){return function(e){if(Array.isArray(e))return Le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Le(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Le(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Me(){return Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Me.apply(null,arguments)}function Fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,De(n.key),n)}}function De(e){var t=function(e,t){if("object"!=_e(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_e(t)?t:t+""}function Re(e,t,r){return t=qe(t),function(e,t){if(t&&("object"==_e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ge()?Reflect.construct(t,r||[],qe(e).constructor):t.apply(e,r))}function Ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ge=function(){return!!e})()}function qe(e){return qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qe(e)}function Ue(e,t){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(e,t)}var Be=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Re(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(t,e),r=t,(n=[{key:"attributeChanged",value:function(e,t,r){var n;if((t=(null===(n=t)||void 0===n?void 0:n.trim())||"")!==(r=r||"")){var o=this.props[e+"NodeAttributes"],i=""in(o=o?Me({},o):{})?o[""]:[],a=i.indexOf(r);if(a<0){if(!t)return;i.push(t)}else t?i.splice(a,1,t):i.splice(a,1);o[""]=ke(new Set(i)),this.props.attributesChanged(e,o)}}},{key:"selector",value:function(e,t,r){var n=this;return pe().createElement(de.Segment,{value:pr.toOption(r||""),onChange:function(t){return n.attributeChanged(e,t.value,r)},options:t||[],inputMinWidth:6,allowCustomValue:!0})}},{key:"render",value:function(){var e=this,t=this.props,r=t.primaryNodeAttributes,n=t.secondaryNodeAttributes,o=t.arcColorNodeAttributes,i=t.primaryArcColor,a=t.secondaryArcColor,u=t.arcColorComplementLabel,l=t.proposedAttributes,s=(r&&""in r?r[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),c=(n&&""in n?n[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),f=(o&&""in o?o[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),p=s.map((function(t){return e.selector("primary",l,t)}));p.push(this.selector("primary",l));var d=c.map((function(t){return e.selector("secondary",l,t)}));d.push(this.selector("secondary",l));var y=f.map((function(t){return e.selector("arcColor",l,t)}));y.push(this.selector("arcColor",l));var h=i||"green",m=a||"red";return pe().createElement(pe().Fragment,null,Oe||(Oe=pe().createElement("h6",null,"Graph settings")),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Se||(Se=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Primary attributes for node values"},"Primary node properties")),p)),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ae||(Ae=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Secondary attributes for node values; shown in a smaller font size below the primary values"},"Secondary node properties")),d)),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ce||(Ce=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Attribute for coloring of node circles; must take values between 0 and 1."},"Arc color properties")),y)),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ne||(Ne=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Label for the complement of the selected arc color property"},"Arc color complement")),pe().createElement(de.Input,{value:u,onChange:function(t){var r;return e.props.onArcColorComplementChanged((null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||"")}}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ie||(Ie=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Primary arc color. Only relevant if a property for the arc color is selected."},"Primary arc color"))," ",pe().createElement(de.ColorPicker,{color:h,onChange:function(t){return e.props.onColorChanged(!0,t)}}),"     ",Pe||(Pe=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Secondary arc color. Only relevant if a property for the arc color is selected."},"Secondary arc color"))," ",pe().createElement(de.ColorPicker,{color:m,onChange:function(t){return e.props.onColorChanged(!1,t)}}))))}}])&&Fe(r.prototype,n),o&&Fe(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(fe.PureComponent);function Ye(e){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(e)}function Qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ke(n.key),n)}}function Ve(e,t,r){return t&&We(e.prototype,t),r&&We(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function He(e,t,r){return(t=Ke(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ke(e){var t=function(e,t){if("object"!=Ye(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ye(t)?t:t+""}var Je,ze,$e,Xe,Ze,et,tt,rt,nt,ot=function(){function e(t){Qe(this,e),He(this,"_seconds",0),He(this,"_minutes",0),He(this,"_hours",0),He(this,"_days",0),He(this,"_months",0),He(this,"_years",0),this._build=t}return Ve(e,[{key:"setSeconds",value:function(t){return this._seconds=e._validate(t),this}},{key:"setMinutes",value:function(t){return this._minutes=e._validate(t),this}},{key:"setHours",value:function(t){return this._hours=e._validate(t),this}},{key:"setDays",value:function(t){return this._days=e._validate(t),this}},{key:"setMonths",value:function(t){return this._months=e._validate(t),this}},{key:"setYears",value:function(t){return this._years=e._validate(t),this}},{key:"build",value:function(){return this._build(this._seconds,this._minutes,this._hours,this._days,this._months,this._years)}}],[{key:"_validate",value:function(e){if(!isFinite(e))throw new Error("Invalid number "+e);return e}}])}(),it=function(){function e(t,r,n,o,i,a){Qe(this,e),He(this,"_isEmpty",void 0),He(this,"_isTimePartEmpty",void 0),this._seconds=t,this._minutes=r,this._hours=n,this._days=o,this._months=i,this._years=a,this._isTimePartEmpty=[t,r,n].findIndex((function(e){return 0!==e}))<0,this._isEmpty=this._isTimePartEmpty&&[o,i,a].findIndex((function(e){return 0!==e}))<0}return Ve(e,[{key:"serialize",value:function(){if(this._isEmpty)return"PT0S";var e="P",t=function(t){0!==t[0]&&(e+=t[0]+t[1])};return[[this._years,"Y"],[this._months,"M"],[this._days,"D"]].forEach(t),this._isTimePartEmpty||(e+="T"),[[this._hours,"H"],[this._minutes,"M"],[this._seconds,"S"]].forEach(t),e}},{key:"seconds",value:function(){return this._seconds}},{key:"minutes",value:function(){return this._minutes}},{key:"hours",value:function(){return this._hours}},{key:"days",value:function(){return this._days}},{key:"months",value:function(){return this._months}},{key:"years",value:function(){return this._years}}],[{key:"builder",value:function(t){var r=new ot((function(t,r,n,o,i,a){return new e(t,r,n,o,i,a)}));return t&&(r.setSeconds(t._seconds),r.setMinutes(t._minutes),r.setHours(t._hours),r.setDays(t._days),r.setMonths(t._months),r.setYears(t._years)),r}},{key:"deserialize",value:function(t){if(t)try{if(!(t=t.toUpperCase()).startsWith("P"))return;var r=t.indexOf("T")>0,n=e.builder(),o=0,i=t.indexOf("Y",o);i>o&&(n.setYears(parseInt(t.substring(o+1,i),10)),o=i);var a=t.indexOf("M",o);a>o&&(!r||a<t.indexOf("T",o))&&(n.setMonths(parseInt(t.substring(o+1,a),10)),o=a);var u=t.indexOf("D",o);u>o&&(n.setDays(parseInt(t.substring(o+1,u),10)),o=u),r&&(o+=1);var l=t.indexOf("H",o);l>o&&(n.setHours(parseInt(t.substring(o+1,l),10)),o=l);var s=t.indexOf("M",o);s>o&&r&&s>t.indexOf("T",o)&&(n.setMinutes(parseInt(t.substring(o+1,s),10)),o=s);var c=t.indexOf("S",o);return c>o&&(n.setSeconds(parseInt(t.substring(o+1,c),10)),o=c),n.build()}catch(e){return}}}])}();function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pt(n.key),n)}}function lt(e,t,r){return t=ct(t),function(e,t){if(t&&("object"==at(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,st()?Reflect.construct(t,r||[],ct(e).constructor):t.apply(e,r))}function st(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(st=function(){return!!e})()}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}function ft(e,t){return ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ft(e,t)}function pt(e){var t=function(e,t){if("object"!=at(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=at(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==at(t)?t:t+""}var dt,yt,ht,mt,vt,bt,gt,Et,wt,Tt,Ot,St=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),lt(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ft(e,t)}(t,e),r=t,(n=[{key:"methodsChanged",value:function(e){this.props.onAggregationMethodChanged(e.map((function(e){return e.value})).filter((function(e){return e})))}},{key:"periodChanged",value:function(e,t,r){var n=parseInt(r||"",10);isFinite(n)&&(e=t.bind(e)(n),this.props.onAggregationPeriodChanged(e.build()))}},{key:"render",value:function(){var e=this,r=this.props,n=r.aggrMethod,o=r.aggrPeriodDuration,i=(n||"").split(",").map((function(e){return e.trim()})).map(s).filter((function(e){return e})),a=it.deserialize(o)||it.builder().build(),u=it.builder(a),l=[pe().createElement("div",{className:"gf-form-inline",key:"aggrmethod"},pe().createElement("div",{className:"gf-form"},Je||(Je=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Temporal aggregation of values. Deselect all to retrieve the original timeseries."},"Aggregation method")),pe().createElement(de.MultiSelect,{options:t.AGGREGATION_METHODS,value:i,onChange:this.methodsChanged.bind(this),width:20})))];return i.length>0&&l.push(pe().createElement("div",{className:"gf-form-inline",key:"aggrperiod"},pe().createElement("div",{className:"gf-form"},ze||(ze=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Temporal aggregation duration. Set all entries to 0 to aggregate over the whole time interval."},"Aggregation period")),pe().createElement(de.Input,{value:a.years(),onChange:function(t){var r,n;return e.periodChanged(u,u.setYears,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Years"}),$e||($e=pe().createElement(de.InlineFormLabel,{width:2},"Y")),pe().createElement(de.Input,{value:a.months(),onChange:function(t){var r,n;return e.periodChanged(u,u.setMonths,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Months"}),Xe||(Xe=pe().createElement(de.InlineFormLabel,{width:2},"M")),pe().createElement(de.Input,{value:a.days(),onChange:function(t){var r,n;return e.periodChanged(u,u.setDays,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Days"}),Ze||(Ze=pe().createElement(de.InlineFormLabel,{width:2},"DT")),pe().createElement(de.Input,{value:a.hours(),onChange:function(t){var r,n;return e.periodChanged(u,u.setHours,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Hours"}),et||(et=pe().createElement(de.InlineFormLabel,{width:2},"H")),pe().createElement(de.Input,{value:a.minutes(),onChange:function(t){var r,n;return e.periodChanged(u,u.setMinutes,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Minutes"}),tt||(tt=pe().createElement(de.InlineFormLabel,{width:2},"M")),pe().createElement(de.Input,{value:a.seconds(),onChange:function(t){var r,n;return e.periodChanged(u,u.setSeconds,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Seconds"}),rt||(rt=pe().createElement(de.InlineFormLabel,{width:2},"S"))))),pe().createElement(pe().Fragment,null,nt||(nt=pe().createElement("h6",null,"Temporal aggregation")),l)}}])&&ut(r.prototype,n),o&&ut(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(fe.PureComponent);function At(e){return At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},At(e)}function Ct(){return Ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ct.apply(null,arguments)}function Nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kt(n.key),n)}}function It(e,t,r){return t=xt(t),function(e,t){if(t&&("object"==At(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pt()?Reflect.construct(t,r||[],xt(e).constructor):t.apply(e,r))}function Pt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Pt=function(){return!!e})()}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}function jt(e,t){return jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jt(e,t)}function _t(e,t,r){return(t=kt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kt(e){var t=function(e,t){if("object"!=At(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=At(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==At(t)?t:t+""}dt=St,yt="AGGREGATION_METHODS",ht=[{value:i.TOTAL_COUNT,label:"Total count",description:"Number of points",title:"Number of points"},{value:i.DISTINCT_COUNT,label:"Distinct count",description:"Number of distinct values",title:"Number of distinct values"},{value:i.SUM,label:"Sum",description:"",title:""},{value:i.AVERAGE,label:"Average",description:"",title:""},{value:i.MIN,label:"Min",description:"",title:""},{value:i.MAX,label:"Max",description:"",title:""},{value:i.STANDARD_DEVIATION,label:"Standard deviation",description:"",title:""},{value:i.SUM_SQUARE,label:"Sum square",description:"Sum of squared valued",title:"Sum of squared valued"}],(yt=pt(yt))in dt?Object.defineProperty(dt,yt,{value:ht,enumerable:!0,configurable:!0,writable:!0}):dt[yt]=ht,function(e){e.MAX_DISTANCE="maxDistance",e.MIN_DISTANCE="minDistance"}(Ot||(Ot={}));var Lt,Mt,Ft,Dt,Rt,Gt,qt,Ut,Bt,Yt,Qt,Wt,Vt,Ht,Kt,Jt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),It(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jt(e,t)}(t,e),function(e,t,r){return t&&Nt(e.prototype,t),r&&Nt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"georelChanged",value:function(e){e||(e=a.NONE);var r=Ct({},this.props,{georel:t.buildGeorel(this.props.georel,{newType:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"distanceTypeChanged",value:function(e){e||(e=Ot.MAX_DISTANCE);var r=Ct({},this.props,{georel:t.buildGeorel(this.props.georel,{newDistanceType:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"distanceChanged",value:function(e){e>0||(e=2e4);var r=Ct({},this.props,{georel:t.buildGeorel(this.props.georel,{newDistance:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"geometryChanged",value:function(e){var t=Ct({},this.props,{geometry:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"geopropertyChanged",value:function(e){var t=Ct({},this.props,{geoproperty:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"coordinatesChanged",value:function(e){var t=Ct({},this.props,{coordinates:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"render",value:function(){var e=this,r=this.props,n=r.georel,o=r.geometry,i=r.coordinates,u=r.geoproperty,l=f(n),s=pe().createElement(pe().Fragment,null,mt||(mt=pe().createElement("h6",null,"Geo filters")),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},vt||(vt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Specify the geo filter to apply (georel property)"},"Geo relation filter")),pe().createElement(de.Select,{options:t.GEOREL_OPTIONS,value:l,onChange:function(t){return e.georelChanged(null==t?void 0:t.value)},width:20}))));if(l===a.NONE)return s;var c=bt||(bt=pe().createElement(pe().Fragment,null));if(l===a.NEAR){var p=(null==n?void 0:n.indexOf("min"))>0,d=(null==n?void 0:n.indexOf("=="))>0?parseFloat(null==n?void 0:n.substring((null==n?void 0:n.lastIndexOf("=="))+2)):2e4;d>0||(d=2e4),c=pe().createElement(pe().Fragment,null,pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},gt||(gt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Distance in meters from specified center"},"Distance (m)")),pe().createElement(de.Input,{value:d,onChange:function(t){var r,n;return e.distanceChanged(parseFloat(null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim()))},type:"number",width:12,title:"Distance in meters"}),pe().createElement(de.Select,{options:t.DISTANCE_OPTIONS,value:p?Ot.MIN_DISTANCE:Ot.MAX_DISTANCE,onChange:function(t){return e.distanceTypeChanged(null==t?void 0:t.value)},width:20}))))}return pe().createElement(pe().Fragment,null,s,c,pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Et||(Et=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Specify the geo filter to apply (georel property)"},"Geo relation filter")),pe().createElement(de.Segment,{value:o||"Point",onChange:function(t){return e.geometryChanged(null==t?void 0:t.value)},options:t.GEOMETRY_OPTIONS,inputMinWidth:12,allowCustomValue:!0}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},wt||(wt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Specify coordinates "},"Coordinates")),pe().createElement(de.Input,{value:i||"",onChange:function(t){var r,n;return e.coordinatesChanged(null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},width:12,placeholder:"[8,40]",type:"text"}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Tt||(Tt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Specify the geo property (geoproperty)"},"Geo property")),pe().createElement(de.Segment,{value:u||"location",onChange:function(t){return e.geopropertyChanged(null==t?void 0:t.value)},options:t.GEOPROPERTY_OPTIONS,inputMinWidth:12,allowCustomValue:!0}))))}}],[{key:"buildGeorel",value:function(e,t){var r=f(t.newType||e);if(r===a.NONE)return"";if(r!==a.NEAR)return r.valueOf();var n=t.newDistance;if(void 0===n){var o,i=(null==e?void 0:e.lastIndexOf("=="))||-1;n=i>0?parseFloat(null==e||null===(o=e.substring(i+2))||void 0===o?void 0:o.trim()):2e4}n>0||(n=2e4);var u=t.newDistanceType;if(void 0===u){var l=(null==e?void 0:e.indexOf(";"))||-1,s=(null==e?void 0:e.lastIndexOf("=="))||-1;u=l>0&&s>0&&"mindistance"===(null==e?void 0:e.substring(l+1,s).trim().toLowerCase())?Ot.MIN_DISTANCE:Ot.MAX_DISTANCE}return"near;"+u.valueOf()+"=="+n}}])}(fe.PureComponent);function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function $t(e){return function(e){if(Array.isArray(e))return er(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Zt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(e,t)||Zt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e,t){if(e){if("string"==typeof e)return er(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?er(e,t):void 0}}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tr(){tr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),u=new x(n||[]);return o(a,"_invoke",{value:C(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",m={};function v(){}function b(){}function g(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,T=w&&w(w(j([])));T&&T!==r&&n.call(T,a)&&(E=T);var O=g.prototype=v.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var s=l.arg,c=s.value;return c&&"object"==zt(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,r,n){var o=p;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=N(u,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(t,r,n);if("normal"===s.type){if(o=n.done?h:d,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=h,n.method="throw",n.arg=s.arg)}}}function N(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,N(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(zt(t)+" is not iterable")}return b.prototype=g,o(O,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=s(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(A.prototype),s(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new A(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),s(O,l,"Generator"),s(O,a,(function(){return this})),s(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function rr(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function nr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){rr(i,n,o,a,u,"next",e)}function u(e){rr(i,n,o,a,u,"throw",e)}a(void 0)}))}}function or(){return or=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},or.apply(null,arguments)}function ir(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fr(n.key),n)}}function ar(e,t,r){return t=lr(t),function(e,t){if(t&&("object"==zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ur()?Reflect.construct(t,r||[],lr(e).constructor):t.apply(e,r))}function ur(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ur=function(){return!!e})()}function lr(e){return lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lr(e)}function sr(e,t){return sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sr(e,t)}function cr(e,t,r){return(t=fr(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fr(e){var t=function(e,t){if("object"!=zt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==zt(t)?t:t+""}_t(Jt,"DISTANCE_OPTIONS",[{value:Ot.MAX_DISTANCE,label:"max radius",description:"Maximum distance from specified point",title:"Maximum distance from specified point (the default)"},{value:Ot.MIN_DISTANCE,label:"min radius",description:"Minimum distance from specified point",title:"Minimum distance from specified point "}]),_t(Jt,"GEOREL_OPTIONS",[{value:a.NONE,label:"none",description:"Disable geo filters",title:"Disable geo filters"},{value:a.NEAR,label:"near",description:"Specify a radius for the included points",title:"Specify a radius for the included points"},{value:a.EQUALS,label:"equals",description:"Geometries must match exactly",title:"Geometries must match exactly"},{value:a.DISJOINT,label:"disjoint",description:"Geometry must lie outside the specified one",title:"Geometry must lie outside the specified one"},{value:a.INTERSECTS,label:"intersects",description:"Geometry must intersect the specified one; shared borders are sufficient",title:"Geometry must intersect the specified one; shared borders are sufficient"},{value:a.WITHIN,label:"within",description:"Geometries must lie within the specified one",title:"Geometries must lie within the specified one"},{value:a.CONTAINS,label:"contains",description:"Geometries must contain the specified one",title:"Geometries must contain the specified one"},{value:a.OVERLAPS,label:"overlaps",description:"Geometry must overlap the specified one; does not match on shared borders",title:"Geometry must overlap the specified one; does not match on shared borders"}]),_t(Jt,"GEOMETRY_OPTIONS",[{value:"Point",label:"Point",description:"A point specified by longitude and latitude",title:"A point specified by longitude and latitude"},{value:"LineString",label:"LineString",description:"A line string specified by an array of points",title:"A line string specified by an array of points"},{value:"Polygon",label:"Polygon",description:"A polygon specified by an array of line strings",title:"A polygon specified by an array of line strings"}]),_t(Jt,"GEOPROPERTY_OPTIONS",[{value:"location",label:"location",description:"The location of an entity (default)",title:"The location of an entity (default)"},{value:"observationSpace",label:"observationSpace",description:"The location observed by an entity",title:"The location observed by an entity"},{value:"operationSpace",label:"operationSpace",description:"The location in which an entity is active",title:"The location in which an entity is active"}]);var pr=function(t){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),cr(t=ar(this,r,[e]),"onEntityTypeChange",(function(e){var n,o=t.props,i=o.onChange,a=o.query,u=o.datasource,l=(null===(n=e.value)||void 0===n?void 0:n.trim())||"";l===r.EMPTY_OPTION_ID&&(l=""),t.loadEntities(u,l),i(or({},a,l?{entityType:l,entityId:void 0,attributes:void 0}:{entityType:l}))})),cr(t,"onEntityNameFieldChange",(function(e){var r,n=t.props;(0,n.onChange)(or({},n.query,{entityName:(null===(r=e.value)||void 0===r?void 0:r.trim())||"id_short"}))})),cr(t,"onAttributeChange",(function(e){var n=t.props;(0,n.onChange)(or({},n.query,{attributes:e.map((function(e){var t,n=(null===(t=e.value)||void 0===t?void 0:t.trim())||"";return n===r.EMPTY_OPTION_ID&&(n=""),n})).filter((function(e){return e}))}))})),cr(t,"onQueryTypeChange",(function(e){var r,n=t.props;(0,n.onChange)(or({},n.query,{queryType:(null==e||null===(r=e.value)||void 0===r?void 0:r.valueOf())||""}))})),cr(t,"onEntityIdChange",(function(e){var n,o=(null===(n=e.value)||void 0===n?void 0:n.trim())||"";o===r.EMPTY_OPTION_ID&&(o="");var i=t.props,a=i.onChange,u=i.query,l=i.datasource;t.loadAttributes(l,o),a(or({},u,o?{entityId:o,attributes:[]}:{entityId:o}))})),cr(t,"onTemporalPropertyChange",(function(e){var r,n=t.props;(0,n.onChange)(or({},n.query,{timeProperty:(null==e||null===(r=e.value)||void 0===r?void 0:r.valueOf())||"observedAt"}))})),cr(t,"onCustomQueryChange",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{customQuery:(null==e?void 0:e.trim())||""}))})),cr(t,"onScopeQueryChange",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{scopeQuery:(null==e?void 0:e.trim())||""}))})),cr(t,"onLongEntityNameChange",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{useLongEntityName:e.currentTarget.checked}))})),cr(t,"onNamePatternChange",(function(e){var r,n=t.props;(0,n.onChange)(or({},n.query,{namePattern:(null==e||null===(r=e.value)||void 0===r?void 0:r.valueOf())||c.ENTITY_PLUS_ATTRIBUTE.valueOf()}))})),cr(t,"onGraphAttributesChanged",(function(e,r){var n=t.props;(0,n.onChange)(or({},n.query,cr({},e+"NodeAttributes",r)))})),cr(t,"onGraphColorChanged",(function(e,r){var n=t.props;(0,n.onChange)(or({},n.query,cr({},(e?"primary":"secondary")+"ArcColor",r)))})),cr(t,"onArcColorComplementChanged",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{arcColorComplementLabel:e}))})),cr(t,"onAggregationMethodChanged",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{aggrMethod:e.length>0?e.map((function(e){return e.valueOf()})).join(","):void 0}))})),cr(t,"onAggregationPeriodChanged",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{aggrPeriodDuration:e.serialize()}))})),cr(t,"onGeoChanged",(function(e){var r=t.props;(0,r.onChange)(or({},r.query,{georel:null==e?void 0:e.georel,geometry:(null==e?void 0:e.geometry)||"Point",coordinates:null==e?void 0:e.coordinates,geoproperty:(null==e?void 0:e.geoproperty)||"location"}))})),t.loadData(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sr(e,t)}(r,t),function(e,t,r){return t&&ir(e.prototype,t),r&&ir(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(r,[{key:"loadData",value:function(){var t=this,r=this.props.datasource.request({queryType:e.TYPES}).then((function(e){return e.forEach((function(e){var t,r=null===(t=e.typeName)||void 0===t?void 0:t.lastIndexOf(".");e.shortName=r>=0&&r<e.typeName.length-1?e.typeName.substring(r+1):e.typeName})),new Promise((function(r){return t.setState({types:e},(function(){return r(e)}))}))})),n=this.props.datasource.request({queryType:e.ATTRIBUTES}).then((function(e){return new Promise((function(r){return t.setState({attributes:e.attributeList},r)}))})),o=r.then(function(){var e=nr(tr().mark((function e(r){var n;return tr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>25&&(r=r.filter((function(e,t){return t<25}))),n=r.length>0?r.map((function(e){return e.typeName})).join(","):void 0,e.abrupt("return",t.loadEntities(t.props.datasource,n,100));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return Promise.all([r,n,o])}},{key:"loadEntities",value:(i=nr(tr().mark((function t(r,n,o){var i,a,u,l,s,c,f,p,d=this;return tr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(null===(i=this.state)||void 0===i||!i.entityIdsByType||!(n in this.state.entityIdsByType)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.request({queryType:e.ENTITY,entityType:n},{limit:o||25});case 7:if(0!==(l=t.sent).length){t.next=10;break}return t.abrupt("return");case 10:return(s=null!==(a=this.state)&&void 0!==a&&a.entityIdsByType?or({},this.state.entityIdsByType):{})[n]=l.map((function(e){return e.id})),c=null!==(u=this.state)&&void 0!==u&&u.attributesByEntityId?or({},this.state.attributesByEntityId):{},f=function(e){return Object.entries(e).filter((function(e){var t=Xt(e,2),r=t[0],n=t[1];return!(T.indexOf(r)>=0||!n.value||!isFinite(n.value))})).map((function(e){var t=Xt(e,2),r=t[0];return t[1],r}))},p=Object.fromEntries(l.map((function(e){return[e.id,f(e)]}))),Object.assign(c,p),t.abrupt("return",new Promise((function(e){return d.setState({entityIdsByType:s,attributesByEntityId:c},e)})));case 17:case"end":return t.stop()}}),t,this)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"loadAttributes",value:(o=nr(tr().mark((function t(r,n){var o,i,a,u,l;return tr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(null===(o=this.state)||void 0===o||!o.attributesByEntityId||!(n in this.state.attributesByEntityId)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.request({queryType:e.ENTITY,entityId:n});case 7:if(a=t.sent){t.next=10;break}return t.abrupt("return");case 10:if(0!==(u=Object.keys(a).filter((function(e){return T.indexOf(e)<0}))).length){t.next=13;break}return t.abrupt("return");case 13:(l=null!==(i=this.state)&&void 0!==i&&i.attributesByEntityId?or({},this.state.attributesByEntityId):{})[n]=u,this.setState({attributesByEntityId:l});case 16:case"end":return t.stop()}}),t,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getEntityTypes",value:function(){var e;if(null===(e=this.state)||void 0===e||!e.types)return[];var t=this.state.types.map((function(e){return{id:e.typeName,name:e.shortName,description:e.typeName}})).map(r.toOption).sort();return t.unshift(r.EMPTY_OPTION),t}},{key:"getEntityIds",value:function(e){var t,n;if(null===(t=this.state)||void 0===t||!t.entityIdsByType)return[];if(!e){var o=[],i=Object.values(this.state.entityIdsByType),a=i.reduce((function(e,t){return Math.max(e,t.length)}),0),u=0;e:for(var l=0;l<a;l++)for(var s=0;s<i.length;s++){var c=i[s];if(l<c.length&&(o.push(r.toOption(c[l])),u++>50))break e}return o.length>0&&o.unshift(r.EMPTY_OPTION),o}if(null!==(n=this.state)&&void 0!==n&&n.entityIdsByType&&e in this.state.entityIdsByType){var f=this.state.entityIdsByType[e].map(r.toOption);return f.length>0&&f.unshift(r.EMPTY_OPTION),f}return[]}},{key:"getAttributes",value:function(e,t,n,o){var i=this.getAttributesInternal(e,t,n);return o&&i.length>0&&i.unshift(r.EMPTY_OPTION),i}},{key:"getEntityNameFields",value:function(e,t){var r=this.getAttributes(e,t),n=r.findIndex((function(e){return"name"===e.value}));if(n>0){var o=r.splice(n,1);r.unshift(o[0])}return r.unshift({value:"id",label:"id",description:"Entity id",title:"Use the entity id as the entity name."}),r.unshift({value:"id_short",label:"id (short)",description:"Short entity id",title:"Use the short form of the entity id as the entity name."}),r}},{key:"getAttributesInternal",value:function(t,n,o){var i,a;if(o===e.NODE_GRAPH){var u,l,s;if((null===(u=this.state)||void 0===u||null===(l=u.attributes)||void 0===l?void 0:l.length)>0)return this.state.attributes.map(r.toOption).sort();if(null!==(s=this.state)&&void 0!==s&&s.attributesByEntityId)return $t(new Set(Object.values(this.state.attributesByEntityId).flatMap((function(e){return e})))).map(r.toOption).sort()}if(n&&null!==(i=this.state)&&void 0!==i&&i.attributesByEntityId&&n in this.state.attributesByEntityId)return this.state.attributesByEntityId[n].map(r.toOption).sort();if(t){var c,f,p=t?null===(c=this.state)||void 0===c||null===(f=c.types)||void 0===f?void 0:f.filter((function(e){return e.typeName===t})):void 0;if(p)return $t(new Set(p.flatMap((function(e){return e.attributeNames})))).map(r.toOption).sort()}return((null===(a=this.state)||void 0===a?void 0:a.attributes)||[]).map(r.toOption).sort()}},{key:"render",value:function(){var t=this,o=n()(this.props.query,d),i=o.entityId,a=o.entityType,u=o.attributes,l=o.namePattern,s=o.entityName,f=o.useLongEntityName,y=o.queryType,h=o.customQuery,m=o.scopeQuery,v=function(t){if(t)switch(t.toLowerCase()){case"entity":case"entities":return e.ENTITY;case"temporal":case"timseries":return e.TEMPORAL;case"geo":return e.GEO;case"type":case"types":return e.TYPES;case"version":return e.VERSION;case"attribute":case"attributes":return e.ATTRIBUTES;case"graph":case"nodegraph":case"node_graph":return e.NODE_GRAPH;default:return}}(y),b=p(l),g=s||(f?"id":"id_short"),E=Mt||(Mt=pe().createElement(pe().Fragment,null));y!==e.NODE_GRAPH&&y!==e.GEO&&(E=pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ft||(Ft=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the naming pattern for the datapoints"},"Naming pattern")),pe().createElement(de.Select,{options:r.NAMING_PATTERNS,value:b,onChange:this.onNamePatternChange,width:22}))));var w=Dt||(Dt=pe().createElement(pe().Fragment,null));b===c.ATTRIBUTE&&y!==e.NODE_GRAPH&&y!==e.GEO||(w=pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Rt||(Rt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the attribute that determines the entity name."},"Entity name")),pe().createElement(de.Segment,{value:g||"",onChange:this.onEntityNameFieldChange,options:this.getEntityNameFields(a),inputMinWidth:20,allowCustomValue:!0}))));var T=Gt||(Gt=pe().createElement(pe().Fragment,null));if(y===e.NODE_GRAPH){var O=o.primaryNodeAttributes,S=o.secondaryNodeAttributes,A=o.arcColorNodeAttributes,C=o.primaryArcColor,N=o.secondaryArcColor,I=o.arcColorComplementLabel;T=pe().createElement(Be,{primaryNodeAttributes:O,secondaryNodeAttributes:S,arcColorNodeAttributes:A,arcColorComplementLabel:I,primaryArcColor:C,secondaryArcColor:N,proposedAttributes:this.getAttributes(a,i,y,!0),attributesChanged:this.onGraphAttributesChanged,onColorChanged:this.onGraphColorChanged,onArcColorComplementChanged:this.onArcColorComplementChanged})}var P=qt||(qt=pe().createElement(pe().Fragment,null));if(y===e.TEMPORAL){var x=o.aggrMethod,j=o.aggrPeriodDuration;P=pe().createElement(St,{aggrMethod:x,aggrPeriodDuration:j,onAggregationMethodChanged:this.onAggregationMethodChanged,onAggregationPeriodChanged:this.onAggregationPeriodChanged})}var _=o.georel,k=o.geometry,L=o.geoproperty,M=o.coordinates,F=pe().createElement(Jt,{georel:_,geometry:k,geoproperty:L,coordinates:M,onGeoChanged:this.onGeoChanged});return pe().createElement("div",{style:{display:"flex",columnGap:"1.5em",rowGap:"1em",flexWrap:"wrap"}},pe().createElement("div",null,Ut||(Ut=pe().createElement("h6",null,"Basic settings and filters")),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Bt||(Bt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Query type"},"Query type")),pe().createElement(de.Select,{options:r.QUERY_TYPES,value:v,onChange:this.onQueryTypeChange,width:22}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Yt||(Yt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the entity type"},"Entity type")),pe().createElement(de.Segment,{value:a||"",onChange:this.onEntityTypeChange,options:this.getEntityTypes(),inputMinWidth:12,allowCustomValue:!0}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Qt||(Qt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Select the entity id"},"Entity id")),pe().createElement(de.Segment,{value:i||"",onChange:this.onEntityIdChange,options:this.getEntityIds(a),inputMinWidth:12,allowCustomValue:!0}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Wt||(Wt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Attributes to include"},"Attributes")),pe().createElement(de.MultiSelect,{options:this.getAttributes(a,i,v),value:u,onChange:this.onAttributeChange,width:22}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Vt||(Vt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"A query string conforming to the NGSI-LD query language, such as speed>50;brandName!='Mercedes'"},"Custom query")),pe().createElement(de.Input,{value:h||"",onChange:function(e){return t.onCustomQueryChange(e.currentTarget.value)},type:"string",placeholder:'speed>50;brandName!="Mercedes"',width:22}))),pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Ht||(Ht=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"A scope query string conforming to the NGSI-LD scope query language, such as '/Madrid/Centro,/Madrid/Cortes'. Formerly called Fiware-ServicePath."},"Scope query")),pe().createElement(de.Input,{value:m||"",onChange:function(e){return t.onScopeQueryChange(e.currentTarget.value)},type:"string",placeholder:"/Madrid/Centro,/Madrid/Cortes",width:22}))),E,w,y===e.TEMPORAL&&pe().createElement(pe().Fragment,null,pe().createElement("div",{className:"gf-form-inline"},pe().createElement("div",{className:"gf-form"},Kt||(Kt=pe().createElement(de.InlineFormLabel,{width:12,tooltip:"Time property to query."},"Time property")),pe().createElement(de.Select,{options:r.TEMPORAL_PROPERTIES,value:o.timeProperty||"observedAt",onChange:this.onTemporalPropertyChange,width:22}))))),pe().createElement("div",null,F),pe().createElement("div",null,T),pe().createElement("div",null,P))}}],[{key:"toOption",value:function(e){var t=e.id||e.name||e+"",r=e.name||t,n=e.description||void 0;return{value:t,label:r,description:n,title:n}}}]);var o,i}(fe.PureComponent);Lt=pr,cr(pr,"EMPTY_OPTION_ID","__EMPTY__"),cr(pr,"EMPTY_OPTION",Object.freeze({name:Lt.EMPTY_OPTION_ID,label:""})),cr(pr,"QUERY_TYPES",[{value:e.TEMPORAL,label:"temporal",description:"Timeseries request",title:"Temporal queries target timeseries data, commonly used in graph plots"},{value:e.ENTITY,label:"current value",description:"Current value request",title:"Query the current value of one or multiple entity attributes"},{value:e.GEO,label:"geo",description:"Geo request",title:"Query the location of entities, useful for map visualizations"},{value:e.NODE_GRAPH,label:"node graph",description:"Node graph request",title:"Retrieve a directed graph dataset for the node graph panel"}]),cr(pr,"NAMING_PATTERNS",[{value:c.ENTITY_PLUS_ATTRIBUTE,label:"Entity plus attribute",description:"Entity name plus attribute",title:'The datapoint label is composed of the entity name + ":" + the attribute name.'},{value:c.ENTITY_NAME,label:"Entity",description:"Entity name",title:"The datapoint label is given by the entity name."},{value:c.ATTRIBUTE,label:"Attribute",description:"Attribute name",title:"The datapoint label is given by the attribute name."}]),cr(pr,"TEMPORAL_PROPERTIES",[{value:"observedAt",label:"observedAt",description:"observedAt, the default measurement timestamp.",title:"This is usually the best choice, representing e.g. the measurment timestamp."},{value:"createdAt",label:"createdAt",description:"Creation timestamp.",title:"Creation timestamp of the entry."},{value:"modifiedAt",label:"modifiedAt",description:"Modification timestamp",title:"Timestamp of last modification."},{value:"deletedAt",label:"deletedAt",description:"Deletion timestamp",title:"Deletion timestamp of the entry."}]);var dr=new t.DataSourcePlugin(ce).setConfigEditor(je).setQueryEditor(pr)})(),l})()));
//# sourceMappingURL=module.js.map